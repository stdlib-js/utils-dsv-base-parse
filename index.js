// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
var e,t;e=this,t=function(){"use strict";var e,t="function"==typeof Object.defineProperty?Object.defineProperty:null,i=Object.defineProperty,n=Object.prototype,r=n.toString,s=n.__defineGetter__,o=n.__defineSetter__,a=n.__lookupGetter__,_=n.__lookupSetter__;e=function(){try{return t({},"x",{}),!0}catch(e){return!1}}()?i:function(e,t,i){var c,h,u,p;if("object"!=typeof e||null===e||"[object Array]"===r.call(e))throw new TypeError("invalid argument. First argument must be an object. Value: `"+e+"`.");if("object"!=typeof i||null===i||"[object Array]"===r.call(i))throw new TypeError("invalid argument. Property descriptor must be an object. Value: `"+i+"`.");if((h="value"in i)&&(a.call(e,t)||_.call(e,t)?(c=e.__proto__,e.__proto__=n,delete e[t],e[t]=i.value,e.__proto__=c):e[t]=i.value),u="get"in i,p="set"in i,h&&(u||p))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return u&&s&&s.call(e,t,i.get),p&&o&&o.call(e,t,i.set),e};var c=e;function h(e,t,i){c(e,t,{configurable:!1,enumerable:!1,writable:!1,value:i})}var u=Boolean;function p(){var e,t=arguments,i=t[0],n="https://stdlib.io/e/"+i+"?";for(e=1;e<t.length;e++)n+="&arg[]="+encodeURIComponent(t[e]);return n}function d(e){return"string"==typeof e}var l="function"==typeof Symbol&&"symbol"==typeof Symbol("foo");function f(){return l&&"symbol"==typeof Symbol.toStringTag}var g=Object.prototype.toString,w=Object.prototype.hasOwnProperty,m="function"==typeof Symbol?Symbol.toStringTag:"",v=f()?function(e){var t,i,n,r,s;if(null==e)return g.call(e);i=e[m],s=m,t=null!=(r=e)&&w.call(r,s);try{e[m]=void 0}catch(t){return g.call(e)}return n=g.call(e),t?e[m]=i:delete e[m],n}:function(e){return g.call(e)},k=String.prototype.valueOf,x=f();function S(e){return"object"==typeof e&&(e instanceof String||(x?function(e){try{return k.call(e),!0}catch(e){return!1}}(e):"[object String]"===v(e)))}function L(e){return d(e)||S(e)}function b(e){return"number"==typeof e}function q(e){var t,i="";for(t=0;t<e;t++)i+="0";return i}function I(e,t,i){var n=!1,r=t-e.length;return r<0||(function(e){return"-"===e[0]}(e)&&(n=!0,e=e.substr(1)),e=i?e+q(r):q(r)+e,n&&(e="-"+e)),e}h(L,"isPrimitive",d),h(L,"isObject",S);var y=String.prototype.toLowerCase,E=String.prototype.toUpperCase;function C(e){var t,i,n;switch(e.specifier){case"b":t=2;break;case"o":t=8;break;case"x":case"X":t=16;break;default:t=10}if(i=e.arg,n=parseInt(i,10),!isFinite(n)){if(!b(i))throw new Error("invalid integer. Value: "+i);n=0}return n<0&&("u"===e.specifier||10!==t)&&(n=4294967295+n+1),n<0?(i=(-n).toString(t),e.precision&&(i=I(i,e.precision,e.padRight)),i="-"+i):(i=n.toString(t),n||e.precision?e.precision&&(i=I(i,e.precision,e.padRight)):i="",e.sign&&(i=e.sign+i)),16===t&&(e.alternate&&(i="0x"+i),i=e.specifier===E.call(e.specifier)?E.call(i):y.call(i)),8===t&&e.alternate&&"0"!==i.charAt(0)&&(i="0"+i),i}function R(e){return"string"==typeof e}var W=Math.abs,O=String.prototype.toLowerCase,V=String.prototype.toUpperCase,A=String.prototype.replace,F=/e\+(\d)$/,N=/e-(\d)$/,T=/^(\d+)$/,P=/^(\d+)e/,j=/\.0$/,B=/\.0*e/,D=/(\..*[^0])0*e/;function $(e){var t,i,n=parseFloat(e.arg);if(!isFinite(n)){if(!b(e.arg))throw new Error("invalid floating-point number. Value: "+i);n=e.arg}switch(e.specifier){case"e":case"E":i=n.toExponential(e.precision);break;case"f":case"F":i=n.toFixed(e.precision);break;case"g":case"G":W(n)<1e-4?((t=e.precision)>0&&(t-=1),i=n.toExponential(t)):i=n.toPrecision(e.precision),e.alternate||(i=A.call(i,D,"$1e"),i=A.call(i,B,"e"),i=A.call(i,j,""));break;default:throw new Error("invalid double notation. Value: "+e.specifier)}return i=A.call(i,F,"e+0$1"),i=A.call(i,N,"e-0$1"),e.alternate&&(i=A.call(i,T,"$1."),i=A.call(i,P,"$1.e")),n>=0&&e.sign&&(i=e.sign+i),i=e.specifier===V.call(e.specifier)?V.call(i):O.call(i)}function G(e){var t,i="";for(t=0;t<e;t++)i+=" ";return i}function U(e,t,i){var n=t-e.length;return n<0?e:e=i?e+G(n):G(n)+e}var Q=String.fromCharCode,Z=isNaN,z=Array.isArray;function M(e){var t={};return t.specifier=e.specifier,t.precision=void 0===e.precision?1:e.precision,t.width=e.width,t.flags=e.flags||"",t.mapping=e.mapping,t}function X(e){var t,i,n,r,s,o,a,_,c;if(!z(e))throw new TypeError("invalid argument. First argument must be an array. Value: `"+e+"`.");for(o="",a=1,_=0;_<e.length;_++)if(R(n=e[_]))o+=n;else{if(t=void 0!==n.precision,!(n=M(n)).specifier)throw new TypeError("invalid argument. Token is missing `specifier` property. Index: `"+_+"`. Value: `"+n+"`.");for(n.mapping&&(a=n.mapping),i=n.flags,c=0;c<i.length;c++)switch(r=i.charAt(c)){case" ":n.sign=" ";break;case"+":n.sign="+";break;case"-":n.padRight=!0,n.padZeros=!1;break;case"0":n.padZeros=i.indexOf("-")<0;break;case"#":n.alternate=!0;break;default:throw new Error("invalid flag: "+r)}if("*"===n.width){if(n.width=parseInt(arguments[a],10),a+=1,Z(n.width))throw new TypeError("the argument for * width at position "+a+" is not a number. Value: `"+n.width+"`.");n.width<0&&(n.padRight=!0,n.width=-n.width)}if(t&&"*"===n.precision){if(n.precision=parseInt(arguments[a],10),a+=1,Z(n.precision))throw new TypeError("the argument for * precision at position "+a+" is not a number. Value: `"+n.precision+"`.");n.precision<0&&(n.precision=1,t=!1)}switch(n.arg=arguments[a],n.specifier){case"b":case"o":case"x":case"X":case"d":case"i":case"u":t&&(n.padZeros=!1),n.arg=C(n);break;case"s":n.maxWidth=t?n.precision:-1;break;case"c":if(!Z(n.arg)){if((s=parseInt(n.arg,10))<0||s>127)throw new Error("invalid character code. Value: "+n.arg);n.arg=Z(s)?String(n.arg):Q(s)}break;case"e":case"E":case"f":case"F":case"g":case"G":t||(n.precision=6),n.arg=$(n);break;default:throw new Error("invalid specifier: "+n.specifier)}n.maxWidth>=0&&n.arg.length>n.maxWidth&&(n.arg=n.arg.substring(0,n.maxWidth)),n.padZeros?n.arg=I(n.arg,n.width||n.precision,n.padRight):n.width&&(n.arg=U(n.arg,n.width,n.padRight)),o+=n.arg||"",a+=1}return o}var H=/%(?:([1-9]\d*)\$)?([0 +\-#]*)(\*|\d+)?(?:(\.)(\*|\d+)?)?[hlL]?([%A-Za-z])/g;function J(e){var t={mapping:e[1]?parseInt(e[1],10):void 0,flags:e[2],width:e[3],precision:e[5],specifier:e[6]};return"."===e[4]&&void 0===e[5]&&(t.precision="1"),t}function K(e){var t,i,n,r;for(i=[],r=0,n=H.exec(e);n;)(t=e.slice(r,H.lastIndex-n[0].length)).length&&i.push(t),i.push(J(n)),r=H.lastIndex,n=H.exec(e);return(t=e.slice(r)).length&&i.push(t),i}function Y(e){return"string"==typeof e}function ee(e){var t,i,n;if(!Y(e))throw new TypeError(ee("invalid argument. First argument must be a string. Value: `%s`.",e));for(t=K(e),(i=new Array(arguments.length))[0]=t,n=1;n<i.length;n++)i[n]=arguments[n];return X.apply(null,i)}var te=/[-\/\\^$*+?.()|[\]{}]/g;function ie(e){var t,i;if(!d(e))throw new TypeError(ee("invalid argument. Must provide a regular expression string. Value: `%s`.",e));if("/"===e[0])for(i=e.length-1;i>=0&&"/"!==e[i];i--);return void 0===i||i<=0?e.replace(te,"\\$&"):(t=(t=e.substring(1,i)).replace(te,"\\$&"),e=e[0]+t+e.substring(i))}function ne(e,t,i){return e.replace(t,i)}function re(){}function se(e){throw e}function oe(){return{comment:"",delimiter:",",doublequote:!0,escape:"",ltrim:!1,maxRows:1e308,newline:"\r\n",onClose:re,onColumn:re,onComment:null,onError:se,onRow:re,onSkip:null,onWarn:null,quote:'"',quoting:!0,rowBuffer:[],rtrim:!1,skip:"",skipBlankRows:!1,skipRow:null,strict:!0,trimComment:!0,whitespace:[" "]}}var ae=["closed","comment","escape","error","field","init","invalid_quote_end","quote_end","quoted_escape","quoted_field","skip","skipped_comment","skipped_escape","skipped_field","skipped_invalid_quote_end","skipped_quote_end","skipped_quoted_escape","skipped_quoted_field"],_e=function(){var e,t;for(e={},t=0;t<ae.length;t++)e[ae[t]]=t;return e}(),ce=_e.closed,he=_e.init,ue=_e.error;function pe(e,t){return e<t?t:e}var de=_e.error,le=_e.field,fe=_e.escape,ge=_e.field,we=_e.init,me=_e.quoted_field,ve=_e.comment,ke=_e.field,xe=_e.escape,Se=_e.init,Le=_e.quoted_field,be=_e.skip,qe=_e.error,Ie=_e.field,ye=_e.init;function Ee(e,t){e._isWhitespace(e._qidx+1,e._cursor)?e._raiseWarning("INVALID_CLOSING_QUOTE")._rewind(e._cursor-e._qidx)._changeState(t):e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(qe)}var Ce=_e.error,Re=_e.field,We=_e.init,Oe=_e.invalid_quote_end,Ve=_e.quoted_field,Ae=_e.error,Fe=_e.quoted_field,Ne=_e.quote_end,Te=_e.quoted_escape,Pe=_e.init,je=_e.skip,Be=_e.skipped_comment,De=_e.skipped_field,$e=_e.skipped_escape,Ge=_e.skipped_quoted_field,Ue=_e.init,Qe=_e.skipped_field,Ze=_e.init,ze=_e.skipped_escape,Me=_e.skipped_field,Xe=_e.skipped_quoted_field,He=_e.skipped_field,Je=_e.init,Ke=_e.init,Ye=_e.skipped_field,et=_e.skipped_invalid_quote_end,tt=_e.skipped_quoted_field,it=_e.skipped_quoted_field,nt=_e.skipped_quote_end,rt=_e.skipped_quoted_escape,st={closed:function(e){return function(){e._changeState(ce)}},comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){n===i[t]&&e._scan(i,t)?e._rewind(t)._changeState(he):e._push(n)}},escape:function(e){var t,i,n,r,s,o,a,_,c,h,u,p,d;return t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,n=e._commentLastIndex,c=e._comment,s=e._skipLastIndex,p=e._skip,r=e._escapeLastIndex,o=e._escapeLength,h=e._escape,u=e._strict,d=pe(pe(t,i),r),function(l){var f=e._cursor,g=e._eidx,w=f-g;if(w===t&&l===a[t]&&e._scan(a,t))e._copyWithin(g-r,g+1,t)._rewind(o)._push(l)._changeState(le);else if(w===i&&l===_[i]&&e._scan(_,i))e._copyWithin(g-r,g+1,i)._rewind(o)._push(l)._changeState(le);else if(w===r&&l===h[r]&&e._scan(h,r))e._copyWithin(g-r,g+1,r)._rewind(o)._push(l)._changeState(le);else if(c&&f-n==0&&l===c[n]&&e._scan(c,n))e._copyWithin(g-n,g+1,n)._rewind(o)._push(l)._changeState(le);else{if(!p||f-s!=0||l!==p[s]||!e._scan(p,s))return w>=d?u?void e._setErrorState("INVALID_ESCAPE")._changeState(de):void e._raiseWarning("INVALID_ESCAPE")._push(l)._changeState(le):void e._push(l);e._copyWithin(g-s,g+1,s)._rewind(o)._push(l)._changeState(le)}}},error:function(e){return function(){e._changeState(ue)}},field:function(e){var t,i,n,r,s,o,a,_,c,h;return n=e._escapeLastIndex,_=e._escape,r=e._quoteLastIndex,h=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,a=e._quoting,c=e._strict,function(u){var p=e._cursor-e._cidx+1;if(u!==_[n]||!e._scan(_,n))return p-r==0&&u===h[r]&&e._scan(h,r)?a?void e._rewind(r)._changeState(me):void e._push(u):!1===c&&u===h[r]&&e._scan(h,r)?a&&e._isWhitespace(e._cidx,e._cursor-r)?void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(p)._changeState(me):void e._push(u):void(u===s[t]&&e._scan(s,t)?e._rewind(t)._changeState(ge):u===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(we):e._push(u));e._push(u)._changeState(fe)}},init:function(e){var t,i,n,r,s,o,a,_,c,h,u,p,d,l;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,l=e._skip,r=e._escapeLastIndex,u=e._escape,s=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,h=e._quoting,p=e._strict,function(f){var g=e._cursor+1;if(c&&g-n==0&&f===c[n]&&e._scan(c,n))e._rewind(n)._changeState(ve);else if(l&&g-o==0&&f===l[o]&&e._scan(l,o))e._rewind(o)._changeState(be);else{if(f!==u[r]||!e._scan(u,r))return g-s==0&&f===d[s]&&e._scan(d,s)?h?void e._rewind(s)._changeState(Le):void e._push(f):!1===p&&f===d[s]&&e._scan(d,s)?h&&e._isWhitespace(0,e._cursor-s)?void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(g)._changeState(Le):void e._push(f):void(f===a[t]&&e._scan(a,t)?e._rewind(t)._changeState(ke):f===_[i]&&e._scan(_,i)?e._rewind(i)._changeState(Se):e._push(f));e._push(f)._changeState(xe)}}},invalid_quote_end:function(e){var t,i,n,r;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,r=e._newline,function(s){return s===n[t]&&e._scan(n,t)?(e._rewind(t),void Ee(e,Ie)):s===r[i]&&e._scan(r,i)?(e._rewind(i),void Ee(e,ye)):void e._push(s)}},quote_end:function(e){var t,i,n,r,s,o,a,_,c;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,_=e._quote,r=e._doublequote,a=e._strict,c=pe(pe(t,i),n),function(h){if(r&&h===_[n]&&e._scan(_,n))e._push(h)._changeState(Ve);else if(h===s[t]&&e._scan(s,t))e._rewind(t)._changeState(Re);else{if(h!==o[i]||!e._scan(o,i))return e._cursor-e._qidx>=c?a?void e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(Ce):void e._push(h)._changeState(Oe):void e._push(h);e._rewind(i)._changeState(We)}}},quoted_escape:function(e){var t,i,n,r,s;return i=e._quoteLastIndex,s=e._quote,t=e._escapeLastIndex,n=e._escapeLength,r=e._strict,function(o){var a=e._cursor,_=e._eidx,c=a-_;if(c!==i||o!==s[i]||!e._scan(s,i))return c>=i?r?void e._setErrorState("INVALID_QUOTED_ESCAPE")._changeState(Ae):void e._raiseWarning("INVALID_QUOTED_ESCAPE")._push(o)._changeState(Fe):void e._push(o);e._copyWithin(_-t,_+1,i)._rewind(n)._push(o)._changeState(Fe)}},quoted_field:function(e){var t,i,n,r,s;return t=e._escapeLastIndex,r=e._escape,i=e._quoteLastIndex,s=e._quote,n=e._doublequote,function(o){!1===n&&o===r[t]&&e._scan(r,t)?e._push(o)._changeState(Te):o===s[i]&&e._scan(s,i)?e._rewind(i)._changeState(Ne):e._push(o)}},skip:function(e){var t,i,n,r,s,o,a,_,c,h,u,p,d,l;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,l=e._skip,r=e._escapeLastIndex,u=e._escape,s=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,a=e._delimiter,i=e._newlineLastIndex,_=e._newline,h=e._quoting,p=e._strict,function(f){var g=e._cursor+1;if(c&&g-n==0&&f===c[n]&&e._scan(c,n))e._push(f)._changeState(Be);else if(l&&g-o==0&&f===l[o]&&e._scan(l,o))e._push(f)._changeState(je);else{if(f!==u[r]||!e._scan(u,r))return g-s==0&&f===d[s]&&e._scan(d,s)?h?void e._push(f)._changeState(Ge):void e._push(f):!1===p&&f===d[s]&&e._scan(d,s)?h&&e._isWhitespace(0,e._cursor-s)?void e._push(f)._changeState(Ge):void e._push(f):void(f===a[t]&&e._scan(a,t)?e._push(f)._changeState(De):f===_[i]&&e._scan(_,i)?e._rewind(i)._changeState(Pe):e._push(f));e._push(f)._changeState($e)}}},skipped_comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){n===i[t]&&e._scan(i,t)?e._rewind(t)._changeState(Ue):e._push(n)}},skipped_escape:function(e){var t,i,n,r,s,o,a,_,c,h,u;return t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,a=e._newline,n=e._commentLastIndex,_=e._comment,s=e._skipLastIndex,h=e._skip,r=e._escapeLastIndex,c=e._escape,u=pe(pe(t,i),r),function(p){var d=e._cursor,l=e._eidx,f=d-l;f===t&&p===o[t]&&e._scan(o,t)||f===i&&p===a[i]&&e._scan(a,i)||f===r&&p===c[r]&&e._scan(c,r)||_&&d-n==0&&p===_[n]&&e._scan(_,n)||h&&d-s==0&&p===h[s]&&e._scan(h,s)||f>=u?e._push(p)._changeState(Qe):e._push(p)}},skipped_field:function(e){var t,i,n,r,s,o,a,_,c,h;return n=e._escapeLastIndex,_=e._escape,r=e._quoteLastIndex,h=e._quote,t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,a=e._quoting,c=e._strict,function(u){var p=e._cursor-e._cidx+1;if(u!==_[n]||!e._scan(_,n))return p-r==0&&u===h[r]&&e._scan(h,r)?(e._push(u),a?void e._changeState(Xe):void 0):!1===c&&u===h[r]&&e._scan(h,r)?(e._push(u),a&&e._isWhitespace(e._cidx,e._cursor-r)?void e._changeState(Xe):void 0):void(u===s[t]&&e._scan(s,t)?e._push(u)._changeState(Me):u===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(Ze):e._push(u));e._push(u)._changeState(ze)}},skipped_invalid_quote_end:function(e){var t,i,n,r;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,r=e._newline,function(s){s===n[t]&&e._scan(n,t)?e._push(s)._changeState(He):s===r[i]&&e._scan(r,i)?e._rewind(i)._changeState(Je):e._push(s)}},skipped_quote_end:function(e){var t,i,n,r,s,o,a,_;return t=e._delimiterLastIndex,s=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,a=e._quote,r=e._doublequote,_=pe(pe(t,i),n),function(c){r&&c===a[n]&&e._scan(a,n)?e._push(c)._changeState(tt):c===s[t]&&e._scan(s,t)?e._push(c)._changeState(Ye):c===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(Ke):e._cursor-e._qidx>=_?e._push(c)._changeState(et):e._push(c)}},skipped_quoted_escape:function(e){var t,i;return t=e._quoteLastIndex,i=e._quote,function(n){var r=e._cursor,s=e._eidx,o=r-s;o===t&&n===i[t]&&e._scan(i,t)||o>=t?e._push(n)._changeState(it):e._push(n)}},skipped_quoted_field:function(e){var t,i,n,r,s;return t=e._escapeLastIndex,r=e._escape,i=e._quoteLastIndex,s=e._quote,n=e._doublequote,function(o){!1===n&&o===r[t]&&e._scan(r,t)?e._push(o)._changeState(rt):o===s[i]&&e._scan(s,i)?e._push(o)._changeState(nt):e._push(o)}}};function ot(e){var t,i;for(t=[],i=0;i<ae.length;i++)t.push(st[ae[i]](e));return t}var at,_t=()=>{},ct=_e.closed,ht=_e.comment,ut=_e.error,pt=_e.escape,dt=_e.field,lt=_e.init,ft=_e.invalid_quote_end,gt=_e.quote_end,wt=_e.quoted_escape,mt=_e.quoted_field,vt=_e.skip;function kt(e){var t,i;for(t="(?:",i=0;i<e.length-1;i++)t+=ie(e[i])+"|";return t+ie(e[i])+")"}function xt(e){var t;return this instanceof xt?(e=e||{},t=oe(),this._buffer=[],this._cursor=-1,this._cidx=0,this._qidx=-1,this._eidx=-1,this._rowBufferFLG=u(e.rowBuffer),this._rowBuffer=e.rowBuffer||t.rowBuffer,this._col=0,this._row=0,this._line=0,this._commented=!1,this._skipped=!1,this._errname="",this._comment=e.comment||t.comment,this._delimiter=e.delimiter||t.delimiter,this._doublequote=void 0===e.doublequote?t.doublequote:e.doublequote,this._escape=e.escape||t.escape,this._ltrim=void 0===e.ltrim?t.ltrim:e.ltrim,this._maxRows=void 0===e.maxRows?t.maxRows:e.maxRows,this._newline=e.newline||t.newline,this._quote=e.quote||t.quote,this._quoting=void 0===e.quoting?t.quoting:e.quoting,this._rtrim=void 0===e.rtrim?t.rtrim:e.rtrim,this._skip=e.skip||t.skip,this._skipBlankRows=void 0===e.skipBlankRows?t.skipBlankRows:e.skipBlankRows,this._skipRow=e.skipRow||t.skipRow,this._strict=void 0===e.strict?t.strict:e.strict,this._trimComment=void 0===e.trimComment?t.trimComment:e.trimComment,this._whitespace=kt(e.whitespace||t.whitespace),this._reWhitespace=new RegExp("^"+this._whitespace+"*([\\S\\s]*?)"+this._whitespace+"*$"),this._reWhitespaceLeft=new RegExp("^"+this._whitespace+"*"),this._reWhitespaceRight=new RegExp(this._whitespace+"*$"),this._onClose=e.onClose||t.onClose,this._onColumn=e.onColumn||t.onColumn,this._onComment=e.onComment||t.onComment,this._onRow=e.onRow||t.onRow,this._onSkip=e.onSkip||t.onSkip,this._onError=e.onError||t.onError,this._onWarn=e.onWarn||t.onWarn,this._commentLength=this._comment.length,this._commentLastIndex=this._commentLength-1,this._delimiterLength=this._delimiter.length,this._delimiterLastIndex=this._delimiterLength-1,this._escapeLength=this._escape.length,this._escapeLastIndex=this._escapeLength-1,this._newlineLength=this._newline.length,this._newlineLastIndex=this._newlineLength-1,this._quoteLength=this._quote.length,this._quoteLastIndex=this._quoteLength-1,this._skipLength=this._skip.length,this._skipLastIndex=this._skipLength-1,this._skipRow&&this._skipRow(0,0)?(this._state=vt,this._skipped=!0):this._state=lt,this._states=ot(this),this):arguments.length?new xt(e):new xt}return _e.skipped_comment,_e.skipped_escape,_e.skipped_field,_e.skipped_invalid_quote_end,_e.skipped_quote_end,_e.skipped_quoted_escape,_e.skipped_quoted_field,h(xt.prototype,"_push",(function(e){var t=this._buffer;return this._cursor+=1,this._cursor>=t.length?(t.push(e),_t("Internal buffer size increased. Length: %d.",t.length)):t[this._cursor]=e,_t("Cursor: %d. Push: %s",this._cursor,e),this})),h(xt.prototype,"_rewind",(function(e){return this._cursor-=e,_t("Rewind: %d. Cursor: %d.",e,this._cursor),this})),h(xt.prototype,"_copyWithin",(function(e,t,i){var n,r;for(n=this._buffer,r=0;r<i;r++)n[e+r]=n[t+r];return this})),h(xt.prototype,"_slice",(function(e,t){return this._buffer.slice(e,t+1).join("")})),h(xt.prototype,"_isWhitespace",(function(e,t){return""===ne(this._slice(e,t),this._reWhitespaceLeft,"")})),h(xt.prototype,"_reset",(function(){return this._col=0,this._cidx=0,this._qidx=-1,this._eidx=-1,this._skipRow&&this._skipRow(this._row,this._line)?(this._state=vt,this._skipped=!0):(this._state=lt,this._skipped=!1),this._commented=!1,this._cursor=-1,this})),h(xt.prototype,"_setField",(function(e,t){var i=this._rowBuffer;return t>=i.length?(i.push(e),_t("Row buffer size increased. Length: %d.",i.length)):i[t]=e,this})),h(xt.prototype,"_getField",(function(e,t){var i=this._slice(e,t);return this._ltrim?this._rtrim?ne(i,this._reWhitespace,"$1"):ne(i,this._reWhitespaceLeft,""):this._rtrim?ne(i,this._reWhitespaceRight,""):i})),h(xt.prototype,"_getRow",(function(){return this._rowBufferFLG?this._rowBuffer:this._rowBuffer.slice(0,this._col)})),h(xt.prototype,"_scan",(function(e,t){var i,n,r;for(i=this._buffer,n=this._cursor-t+1,r=0;r<t&&i[n+r]===e[r];r++);return r===t})),h(xt.prototype,"_onField",(function(){var e=this._getField(this._cidx,this._cursor);return this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),_t("Field. Line: %d. Row: %d. Column: %d. Value: %s",this._line,this._row,this._col,e),this._col+=1,this._cidx=this._cursor+1,this._qidx=-1,this._eidx=-1,this})),h(xt.prototype,"_onRecord",(function(){var e;return e=this._getField(this._cidx,this._cursor),!this._skipBlankRows||0!==this._col||""!==e&&""!==ne(e,this._reWhitespaceLeft,"")?(this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),this._col+=1,this._onRow(this._getRow(),this._row,this._col,this._line),_t("Record. Line: %d. Fields: %d.",this._line,this._col),this._row+=1,this._line+=1,this._reset(),this._row>=this._maxRows&&this._changeState(ct),this):this._onSkippedRow()})),h(xt.prototype,"_onCommentedRow",(function(){var e;return this._onComment?(e=this._slice(0,this._cursor),this._trimComment&&(e=ne(e,this._reWhitespaceLeft,"")),this._onComment(e,this._line),_t("Comment. Line: %d. Value: %s",this._line,e)):_t("Comment. Line: %d.",this._line),this._line+=1,this._reset(),this})),h(xt.prototype,"_onSkippedRow",(function(){var e;return this._onSkip?(e=this._slice(0,this._cursor),this._onSkip(e,this._line),_t("Skipped row. Line: %d. Value: %s",this._line,e)):_t("Skipped row. Line: %d.",this._line),this._line+=1,this._reset(),this})),h(xt.prototype,"_onClosingQuote",(function(){return this._qidx=this._cursor,this})),h(xt.prototype,"_onEscape",(function(){return this._eidx=this._cursor,this})),h(xt.prototype,"_createException",(function(e){var t;switch(e){case"INVALID_CLOSING_QUOTE":t=new Error(p("unexpected error. Encountered an invalid record. Field %d on line %d contains a closing quote which is not immediately followed by a delimiter or newline.",this._col,this._line));break;case"INVALID_OPENING_QUOTE":t=new Error(p("unexpected error. Encountered an invalid record. Field %d on line %d contains an opening quote which does not immediately follow a delimiter or newline.",this._col,this._line));break;case"INVALID_ESCAPE":t=new Error(p("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence which is not immediately followed by a special character sequence.",this._col,this._line));break;case"INVALID_QUOTED_ESCAPE":t=new Error(p("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence within a quoted field which is not immediately followed by a quote sequence.",this._col,this._line));break;case"CLOSED":t=new Error("invalid operation. Parser is unable to parse new chunks, as the parser has been closed. To parse new chunks, create a new parser instance.");break;default:t=new Error("invalid operation. Parser is in an unrecoverable error state. To parse new chunks, create a new parser instance.")}return t})),h(xt.prototype,"_raiseWarning",(function(e){var t;return this._onWarn&&(t=this._createException(e),_t("Warning: %s",t.message),this._onWarn(t)),this})),h(xt.prototype,"_raiseException",(function(){var e=this._createException(this._errname);return _t("Error: %s",e.message),this._onError(e),this})),h(xt.prototype,"_changeState",(function(e){switch(_t("State transition: %s -> %s.",ae[this._state],ae[e]),e){case ct:this._close();break;case ht:this._commented=!0;break;case ut:this._raiseException();break;case pt:this._onEscape();break;case dt:this._state!==pt&&this._onField();break;case lt:this._commented?this._onCommentedRow():this._skipped?this._onSkippedRow():this._onRecord();break;case ft:break;case gt:this._onClosingQuote();break;case wt:this._onEscape();break;case mt:break;case vt:this._skipped=!0}return this._state=e,this})),h(xt.prototype,"_setErrorState",(function(e){return this._errname=e,this})),h(xt.prototype,"_close",(function(){var e,t;return this.done?(this._setErrorState(ct)._changeState(ut),this):(this._cursor>=0?(e=this._state)===lt||e===dt||e===gt?this._changeState(lt)._onClose():(this._col&&this._onRow(this._getRow(),this._row,this._col),t=this._slice(this._cidx,this._cursor),this._onClose(t)):this._onClose(),this)})),h(xt.prototype,"next",(function(e){var t,i;if(this.done)return this._setErrorState(ct)._changeState(ut),this;for(t=this._states,i=0;i<e.length;i++)if(t[this._state](e[i]),this._state===ct||this._state===ut)return this;return this})),h(xt.prototype,"close",(function(){return this.done||this._changeState(ct),this})),at=xt.prototype,c(at,"done",{configurable:!1,enumerable:!1,get:function(){return this._state===ct||this._state===ut}}),xt},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Parser=t();
//# sourceMappingURL=index.js.map
