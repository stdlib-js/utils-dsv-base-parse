// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/boolean-ctor@v0.2.2-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.2-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-escape-regexp-string@v0.2.1-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/string-base-replace@v0.2.2-esm/index.mjs";import _ from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-noop@v0.2.2-esm/index.mjs";function o(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),i}var a=o(Object.freeze({__proto__:null,default:()=>()=>{}}));function h(e){throw e}var c=["closed","comment","escape","error","field","init","invalid_quote_end","quote_end","quoted_escape","quoted_field","skip","skipped_comment","skipped_escape","skipped_field","skipped_invalid_quote_end","skipped_quote_end","skipped_quoted_escape","skipped_quoted_field"];var u=function(){var e,t;for(e={},t=0;t<c.length;t++)e[c[t]]=t;return e}(),d=u.closed;var p=a("state:comment"),l=u.init;var f=u.error;function m(e,t){return e<t?t:e}var v=a("state:escape"),w=u.error,g=u.field;var k=a("state:field"),q=u.escape,x=u.field,S=u.init,L=u.quoted_field;var I=a("state:init"),E=u.comment,C=u.field,b=u.escape,R=u.init,y=u.quoted_field,N=u.skip;var W=a("state:invalid_quote_end"),D=u.error,j=u.field,O=u.init;function Q(e,t){e._isWhitespace(e._qidx+1,e._cursor)?e._raiseWarning("INVALID_CLOSING_QUOTE")._rewind(e._cursor-e._qidx)._changeState(t):(W("Error."),e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(D))}var A=a("state:quote_end"),V=u.error,B=u.field,P=u.init,F=u.invalid_quote_end,T=u.quoted_field;var U=a("state:quoted_escape"),G=u.error,H=u.quoted_field;var z=a("state:quoted_field"),$=u.quote_end,M=u.quoted_escape;var J=a("state:skip"),K=u.init,X=u.skip,Y=u.skipped_comment,Z=u.skipped_field,ee=u.skipped_escape,te=u.skipped_quoted_field;var ie=a("state:skipped_comment"),ne=u.init;var se=a("state:skipped_escape"),re=u.skipped_field;var _e=a("state:skipped_field"),oe=u.init,ae=u.skipped_escape,he=u.skipped_field,ce=u.skipped_quoted_field;var ue=a("state:skipped_invalid_quote_end"),de=u.skipped_field,pe=u.init;var le=a("state:skipped_quote_end"),fe=u.init,me=u.skipped_field,ve=u.skipped_invalid_quote_end,we=u.skipped_quoted_field;var ge=a("state:skipped_quoted_escape"),ke=u.skipped_quoted_field;var qe=a("state:skipped_quoted_field"),xe=u.skipped_quote_end,Se=u.skipped_quoted_escape;var Le={closed:function(e){return function(){e._changeState(d)}},comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){if(p("Char: %s",n),n===i[t]&&e._scan(i,t))return p("Newline."),void e._rewind(t)._changeState(l);e._push(n)}},escape:function(e){var t,i,n,s,r,_,o,a,h,c,u,d,p;return t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,a=e._newline,n=e._commentLastIndex,h=e._comment,r=e._skipLastIndex,d=e._skip,s=e._escapeLastIndex,_=e._escapeLength,c=e._escape,u=e._strict,p=m(m(t,i),s),function(l){var f=e._cursor,m=e._eidx,k=f-m;if(v("Char: %s",l),k===t&&l===o[t]&&e._scan(o,t))return v("Delimiter."),void e._copyWithin(m-s,m+1,t)._rewind(_)._push(l)._changeState(g);if(k===i&&l===a[i]&&e._scan(a,i))return v("Newline."),void e._copyWithin(m-s,m+1,i)._rewind(_)._push(l)._changeState(g);if(k===s&&l===c[s]&&e._scan(c,s))return v("Escape."),void e._copyWithin(m-s,m+1,s)._rewind(_)._push(l)._changeState(g);if(h&&f-n==0&&l===h[n]&&e._scan(h,n))return v("Comment."),void e._copyWithin(m-n,m+1,n)._rewind(_)._push(l)._changeState(g);if(d&&f-r==0&&l===d[r]&&e._scan(d,r))return v("Skip."),void e._copyWithin(m-r,m+1,r)._rewind(_)._push(l)._changeState(g);if(k>=p)return u?(v("Error."),void e._setErrorState("INVALID_ESCAPE")._changeState(w)):(v("Escape sequence is not followed by a special character sequence."),void e._raiseWarning("INVALID_ESCAPE")._push(l)._changeState(g));e._push(l)}},error:function(e){return function(){e._changeState(f)}},field:function(e){var t,i,n,s,r,_,o,a,h,c;return n=e._escapeLastIndex,a=e._escape,s=e._quoteLastIndex,c=e._quote,t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,_=e._newline,o=e._quoting,h=e._strict,function(u){var d=e._cursor-e._cidx+1;if(k("Char: %s",u),u===a[n]&&e._scan(a,n))return k("Escape."),void e._push(u)._changeState(q);if(d-s==0&&u===c[s]&&e._scan(c,s))return o?(k("Quote."),void e._rewind(s)._changeState(L)):void e._push(u);if(!1===h&&u===c[s]&&e._scan(c,s))return o&&e._isWhitespace(e._cidx,e._cursor-s)?(k("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(d)._changeState(L)):void e._push(u);if(u===r[t]&&e._scan(r,t))return k("Delimiter."),void e._rewind(t)._changeState(x);if(u===_[i]&&e._scan(_,i))return k("Newline."),void e._rewind(i)._changeState(S);e._push(u)}},init:function(e){var t,i,n,s,r,_,o,a,h,c,u,d,p,l;return n=e._commentLastIndex,h=e._comment,_=e._skipLastIndex,l=e._skip,s=e._escapeLastIndex,u=e._escape,r=e._quoteLastIndex,p=e._quote,t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,a=e._newline,c=e._quoting,d=e._strict,function(f){var m=e._cursor+1;if(I("Char: %s",f),h&&m-n==0&&f===h[n]&&e._scan(h,n))return I("Comment."),void e._rewind(n)._changeState(E);if(l&&m-_==0&&f===l[_]&&e._scan(l,_))return I("Skip."),void e._rewind(_)._changeState(N);if(f===u[s]&&e._scan(u,s))return I("Escape."),void e._push(f)._changeState(b);if(m-r==0&&f===p[r]&&e._scan(p,r))return c?(I("Quote."),void e._rewind(r)._changeState(y)):void e._push(f);if(!1===d&&f===p[r]&&e._scan(p,r))return c&&e._isWhitespace(0,e._cursor-r)?(I("Quote."),void e._raiseWarning("INVALID_OPENING_QUOTE")._rewind(m)._changeState(y)):void e._push(f);if(f===o[t]&&e._scan(o,t))return I("Delimiter."),void e._rewind(t)._changeState(C);if(f===a[i]&&e._scan(a,i))return I("Newline."),void e._rewind(i)._changeState(R);e._push(f)}},invalid_quote_end:function(e){var t,i,n,s;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,s=e._newline,function(r){if(W("Char: %s",r),r===n[t]&&e._scan(n,t))return W("Delimiter."),e._rewind(t),void Q(e,j);if(r===s[i]&&e._scan(s,i))return W("Newline."),e._rewind(i),void Q(e,O);e._push(r)}},quote_end:function(e){var t,i,n,s,r,_,o,a,h;return t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,_=e._newline,n=e._quoteLastIndex,a=e._quote,s=e._doublequote,o=e._strict,h=m(m(t,i),n),function(c){if(A("Char: %s",c),s&&c===a[n]&&e._scan(a,n))return A("Double quote."),void e._push(c)._changeState(T);if(c===r[t]&&e._scan(r,t))return A("Delimiter."),void e._rewind(t)._changeState(B);if(c===_[i]&&e._scan(_,i))return A("Newline."),void e._rewind(i)._changeState(P);if(e._cursor-e._qidx>=h)return o?(A("Error."),void e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(V)):(A("Invalid closing quote."),void e._push(c)._changeState(F));e._push(c)}},quoted_escape:function(e){var t,i,n,s,r;return i=e._quoteLastIndex,r=e._quote,t=e._escapeLastIndex,n=e._escapeLength,s=e._strict,function(_){var o=e._cursor,a=e._eidx,h=o-a;if(U("Char: %s",_),h===i&&_===r[i]&&e._scan(r,i))return U("Quote."),void e._copyWithin(a-t,a+1,i)._rewind(n)._push(_)._changeState(H);if(h>=i)return s?(U("Error."),void e._setErrorState("INVALID_QUOTED_ESCAPE")._changeState(G)):(U("Escape sequence is not followed by a quote sequence."),void e._raiseWarning("INVALID_QUOTED_ESCAPE")._push(_)._changeState(H));e._push(_)}},quoted_field:function(e){var t,i,n,s,r;return t=e._escapeLastIndex,s=e._escape,i=e._quoteLastIndex,r=e._quote,n=e._doublequote,function(_){if(z("Char: %s",_),!1===n&&_===s[t]&&e._scan(s,t))return z("Escape."),void e._push(_)._changeState(M);if(_===r[i]&&e._scan(r,i))return z("Quote."),void e._rewind(i)._changeState($);e._push(_)}},skip:function(e){var t,i,n,s,r,_,o,a,h,c,u,d,p,l;return n=e._commentLastIndex,h=e._comment,_=e._skipLastIndex,l=e._skip,s=e._escapeLastIndex,u=e._escape,r=e._quoteLastIndex,p=e._quote,t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,a=e._newline,c=e._quoting,d=e._strict,function(f){var m=e._cursor+1;if(J("Char: %s",f),h&&m-n==0&&f===h[n]&&e._scan(h,n))return J("Comment."),void e._push(f)._changeState(Y);if(l&&m-_==0&&f===l[_]&&e._scan(l,_))return J("Skip."),void e._push(f)._changeState(X);if(f===u[s]&&e._scan(u,s))return J("Escape."),void e._push(f)._changeState(ee);if(m-r==0&&f===p[r]&&e._scan(p,r))return c?(J("Quote."),void e._push(f)._changeState(te)):void e._push(f);if(!1===d&&f===p[r]&&e._scan(p,r))return c&&e._isWhitespace(0,e._cursor-r)?(J("Quote."),void e._push(f)._changeState(te)):void e._push(f);if(f===o[t]&&e._scan(o,t))return J("Delimiter."),void e._push(f)._changeState(Z);if(f===a[i]&&e._scan(a,i))return J("Newline."),void e._rewind(i)._changeState(K);e._push(f)}},skipped_comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){if(ie("Char: %s",n),n===i[t]&&e._scan(i,t))return ie("Newline."),void e._rewind(t)._changeState(ne);e._push(n)}},skipped_escape:function(e){var t,i,n,s,r,_,o,a,h,c,u;return t=e._delimiterLastIndex,_=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._commentLastIndex,a=e._comment,r=e._skipLastIndex,c=e._skip,s=e._escapeLastIndex,h=e._escape,u=m(m(t,i),s),function(d){var p=e._cursor,l=e._eidx,f=p-l;if(se("Char: %s",d),f===t&&d===_[t]&&e._scan(_,t))return se("Delimiter."),void e._push(d)._changeState(re);if(f===i&&d===o[i]&&e._scan(o,i))return se("Newline."),void e._push(d)._changeState(re);if(f===s&&d===h[s]&&e._scan(h,s))return se("Escape."),void e._push(d)._changeState(re);if(a&&p-n==0&&d===a[n]&&e._scan(a,n))return se("Comment."),void e._push(d)._changeState(re);if(c&&p-r==0&&d===c[r]&&e._scan(c,r))return se("Skip."),void e._push(d)._changeState(re);if(f>=u)return se("Normal character sequence."),void e._push(d)._changeState(re);e._push(d)}},skipped_field:function(e){var t,i,n,s,r,_,o,a,h,c;return n=e._escapeLastIndex,a=e._escape,s=e._quoteLastIndex,c=e._quote,t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,_=e._newline,o=e._quoting,h=e._strict,function(u){var d=e._cursor-e._cidx+1;if(_e("Char: %s",u),u===a[n]&&e._scan(a,n))return _e("Escape."),void e._push(u)._changeState(ae);if(d-s==0&&u===c[s]&&e._scan(c,s))return e._push(u),o?(_e("Quote."),void e._changeState(ce)):void 0;if(!1===h&&u===c[s]&&e._scan(c,s))return e._push(u),o&&e._isWhitespace(e._cidx,e._cursor-s)?(_e("Quote."),void e._changeState(ce)):void 0;if(u===r[t]&&e._scan(r,t))return _e("Delimiter."),void e._push(u)._changeState(he);if(u===_[i]&&e._scan(_,i))return _e("Newline."),void e._rewind(i)._changeState(oe);e._push(u)}},skipped_invalid_quote_end:function(e){var t,i,n,s;return t=e._delimiterLastIndex,n=e._delimiter,i=e._newlineLastIndex,s=e._newline,function(r){if(ue("Char: %s",r),r===n[t]&&e._scan(n,t))return ue("Delimiter."),void e._push(r)._changeState(de);if(r===s[i]&&e._scan(s,i))return ue("Newline."),void e._rewind(i)._changeState(pe);e._push(r)}},skipped_quote_end:function(e){var t,i,n,s,r,_,o,a;return t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,_=e._newline,n=e._quoteLastIndex,o=e._quote,s=e._doublequote,a=m(m(t,i),n),function(h){if(le("Char: %s",h),s&&h===o[n]&&e._scan(o,n))return le("Double quote."),void e._push(h)._changeState(we);if(h===r[t]&&e._scan(r,t))return le("Delimiter."),void e._push(h)._changeState(me);if(h===_[i]&&e._scan(_,i))return le("Newline."),void e._rewind(i)._changeState(fe);if(e._cursor-e._qidx>=a)return le("Invalid closing quote."),void e._push(h)._changeState(ve);e._push(h)}},skipped_quoted_escape:function(e){var t,i;return t=e._quoteLastIndex,i=e._quote,function(n){var s=e._cursor,r=e._eidx,_=s-r;if(ge("Char: %s",n),_===t&&n===i[t]&&e._scan(i,t))return ge("Quote."),void e._push(n)._changeState(ke);if(_>=t)return ge("Escape sequence is not followed by a quote sequence."),void e._push(n)._changeState(ke);e._push(n)}},skipped_quoted_field:function(e){var t,i,n,s,r;return t=e._escapeLastIndex,s=e._escape,i=e._quoteLastIndex,r=e._quote,n=e._doublequote,function(_){if(qe("Char: %s",_),!1===n&&_===s[t]&&e._scan(s,t))return qe("Escape."),void e._push(_)._changeState(Se);if(_===r[i]&&e._scan(r,i))return qe("Quote."),void e._push(_)._changeState(xe);e._push(_)}}};var Ie=a("parser"),Ee=u.closed,Ce=u.comment,be=u.error,Re=u.escape,ye=u.field,Ne=u.init,We=u.invalid_quote_end,De=u.quote_end,je=u.quoted_escape,Oe=u.quoted_field,Qe=u.skip;function Ae(e){var t;return this instanceof Ae?(e=e||{},t={comment:"",delimiter:",",doublequote:!0,escape:"",ltrim:!1,maxRows:1e308,newline:"\r\n",onClose:_,onColumn:_,onComment:null,onError:h,onRow:_,onSkip:null,onWarn:null,quote:'"',quoting:!0,rowBuffer:[],rtrim:!1,skip:"",skipBlankRows:!1,skipRow:null,strict:!0,trimComment:!0,whitespace:[" "]},this._buffer=[],this._cursor=-1,this._cidx=0,this._qidx=-1,this._eidx=-1,this._rowBufferFLG=i(e.rowBuffer),this._rowBuffer=e.rowBuffer||t.rowBuffer,this._col=0,this._row=0,this._line=0,this._commented=!1,this._skipped=!1,this._errname="",this._comment=e.comment||t.comment,this._delimiter=e.delimiter||t.delimiter,this._doublequote=void 0===e.doublequote?t.doublequote:e.doublequote,this._escape=e.escape||t.escape,this._ltrim=void 0===e.ltrim?t.ltrim:e.ltrim,this._maxRows=void 0===e.maxRows?t.maxRows:e.maxRows,this._newline=e.newline||t.newline,this._quote=e.quote||t.quote,this._quoting=void 0===e.quoting?t.quoting:e.quoting,this._rtrim=void 0===e.rtrim?t.rtrim:e.rtrim,this._skip=e.skip||t.skip,this._skipBlankRows=void 0===e.skipBlankRows?t.skipBlankRows:e.skipBlankRows,this._skipRow=e.skipRow||t.skipRow,this._strict=void 0===e.strict?t.strict:e.strict,this._trimComment=void 0===e.trimComment?t.trimComment:e.trimComment,this._whitespace=function(e){var t,i;for(t="(?:",i=0;i<e.length-1;i++)t+=s(e[i])+"|";return t+s(e[i])+")"}(e.whitespace||t.whitespace),this._reWhitespace=new RegExp("^"+this._whitespace+"*([\\S\\s]*?)"+this._whitespace+"*$"),this._reWhitespaceLeft=new RegExp("^"+this._whitespace+"*"),this._reWhitespaceRight=new RegExp(this._whitespace+"*$"),this._onClose=e.onClose||t.onClose,this._onColumn=e.onColumn||t.onColumn,this._onComment=e.onComment||t.onComment,this._onRow=e.onRow||t.onRow,this._onSkip=e.onSkip||t.onSkip,this._onError=e.onError||t.onError,this._onWarn=e.onWarn||t.onWarn,this._commentLength=this._comment.length,this._commentLastIndex=this._commentLength-1,this._delimiterLength=this._delimiter.length,this._delimiterLastIndex=this._delimiterLength-1,this._escapeLength=this._escape.length,this._escapeLastIndex=this._escapeLength-1,this._newlineLength=this._newline.length,this._newlineLastIndex=this._newlineLength-1,this._quoteLength=this._quote.length,this._quoteLastIndex=this._quoteLength-1,this._skipLength=this._skip.length,this._skipLastIndex=this._skipLength-1,this._skipRow&&this._skipRow(0,0)?(this._state=Qe,this._skipped=!0):this._state=Ne,this._states=function(e){var t,i;for(t=[],i=0;i<c.length;i++)t.push(Le[c[i]](e));return t}(this),this):arguments.length?new Ae(e):new Ae}u.skipped_comment,u.skipped_escape,u.skipped_field,u.skipped_invalid_quote_end,u.skipped_quote_end,u.skipped_quoted_escape,u.skipped_quoted_field,e(Ae.prototype,"_push",(function(e){var t=this._buffer;return this._cursor+=1,this._cursor>=t.length?(t.push(e),Ie("Internal buffer size increased. Length: %d.",t.length)):t[this._cursor]=e,Ie("Cursor: %d. Push: %s",this._cursor,e),this})),e(Ae.prototype,"_rewind",(function(e){return this._cursor-=e,Ie("Rewind: %d. Cursor: %d.",e,this._cursor),this})),e(Ae.prototype,"_copyWithin",(function(e,t,i){var n,s;for(n=this._buffer,s=0;s<i;s++)n[e+s]=n[t+s];return this})),e(Ae.prototype,"_slice",(function(e,t){return this._buffer.slice(e,t+1).join("")})),e(Ae.prototype,"_isWhitespace",(function(e,t){return""===r(this._slice(e,t),this._reWhitespaceLeft,"")})),e(Ae.prototype,"_reset",(function(){return this._col=0,this._cidx=0,this._qidx=-1,this._eidx=-1,this._skipRow&&this._skipRow(this._row,this._line)?(this._state=Qe,this._skipped=!0):(this._state=Ne,this._skipped=!1),this._commented=!1,this._cursor=-1,Ie("Parser reset."),this})),e(Ae.prototype,"_setField",(function(e,t){var i=this._rowBuffer;return t>=i.length?(i.push(e),Ie("Row buffer size increased. Length: %d.",i.length)):i[t]=e,this})),e(Ae.prototype,"_getField",(function(e,t){var i=this._slice(e,t);return this._ltrim?this._rtrim?r(i,this._reWhitespace,"$1"):r(i,this._reWhitespaceLeft,""):this._rtrim?r(i,this._reWhitespaceRight,""):i})),e(Ae.prototype,"_getRow",(function(){return this._rowBufferFLG?this._rowBuffer:this._rowBuffer.slice(0,this._col)})),e(Ae.prototype,"_scan",(function(e,t){var i,n,s;for(i=this._buffer,n=this._cursor-t+1,s=0;s<t&&i[n+s]===e[s];s++);return s===t})),e(Ae.prototype,"_onField",(function(){var e=this._getField(this._cidx,this._cursor);return this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),Ie("Field. Line: %d. Row: %d. Column: %d. Value: %s",this._line,this._row,this._col,e),this._col+=1,this._cidx=this._cursor+1,this._qidx=-1,this._eidx=-1,this})),e(Ae.prototype,"_onRecord",(function(){var e;return e=this._getField(this._cidx,this._cursor),!this._skipBlankRows||0!==this._col||""!==e&&""!==r(e,this._reWhitespaceLeft,"")?(this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),this._col+=1,this._onRow(this._getRow(),this._row,this._col,this._line),Ie("Record. Line: %d. Fields: %d.",this._line,this._col),this._row+=1,this._line+=1,this._reset(),this._row>=this._maxRows&&this._changeState(Ee),this):this._onSkippedRow()})),e(Ae.prototype,"_onCommentedRow",(function(){var e;return this._onComment?(e=this._slice(0,this._cursor),this._trimComment&&(e=r(e,this._reWhitespaceLeft,"")),this._onComment(e,this._line),Ie("Comment. Line: %d. Value: %s",this._line,e)):Ie("Comment. Line: %d.",this._line),this._line+=1,this._reset(),this})),e(Ae.prototype,"_onSkippedRow",(function(){var e;return this._onSkip?(e=this._slice(0,this._cursor),this._onSkip(e,this._line),Ie("Skipped row. Line: %d. Value: %s",this._line,e)):Ie("Skipped row. Line: %d.",this._line),this._line+=1,this._reset(),this})),e(Ae.prototype,"_onClosingQuote",(function(){return this._qidx=this._cursor,this})),e(Ae.prototype,"_onEscape",(function(){return this._eidx=this._cursor,this})),e(Ae.prototype,"_createException",(function(e){var t;switch(e){case"INVALID_CLOSING_QUOTE":t=new Error(n("1hHET",this._col,this._line));break;case"INVALID_OPENING_QUOTE":t=new Error(n("1hHEU",this._col,this._line));break;case"INVALID_ESCAPE":t=new Error(n("1hHEV",this._col,this._line));break;case"INVALID_QUOTED_ESCAPE":t=new Error(n("1hHEW",this._col,this._line));break;case"CLOSED":t=new Error(n("1hHD6"));break;default:t=new Error(n("1hHD7"))}return t})),e(Ae.prototype,"_raiseWarning",(function(e){var t;return this._onWarn&&(t=this._createException(e),Ie("Warning: %s",t.message),this._onWarn(t)),this})),e(Ae.prototype,"_raiseException",(function(){var e=this._createException(this._errname);return Ie("Error: %s",e.message),this._onError(e),this})),e(Ae.prototype,"_changeState",(function(e){switch(Ie("State transition: %s -> %s.",c[this._state],c[e]),e){case Ee:this._close();break;case Ce:this._commented=!0;break;case be:this._raiseException();break;case Re:this._onEscape();break;case ye:this._state!==Re&&this._onField();break;case Ne:this._commented?this._onCommentedRow():this._skipped?this._onSkippedRow():this._onRecord();break;case We:break;case De:this._onClosingQuote();break;case je:this._onEscape();break;case Oe:break;case Qe:this._skipped=!0}return this._state=e,this})),e(Ae.prototype,"_setErrorState",(function(e){return e?Ie("Error: %s.",e):Ie("Reset error state."),this._errname=e,this})),e(Ae.prototype,"_close",(function(){var e,t;return this.done?(this._setErrorState(Ee)._changeState(be),this):(this._cursor>=0?(e=this._state)===Ne||e===ye||e===De?this._changeState(Ne)._onClose():(this._col&&this._onRow(this._getRow(),this._row,this._col),t=this._slice(this._cidx,this._cursor),Ie("Flush: %s",t),this._onClose(t)):this._onClose(),Ie("Closed."),this)})),e(Ae.prototype,"next",(function(e){var t,i;if(Ie("Chunk: %s",e),this.done)return this._setErrorState(Ee)._changeState(be),this;for(t=this._states,i=0;i<e.length;i++)if(t[this._state](e[i]),this._state===Ee||this._state===be)return this;return this})),e(Ae.prototype,"close",(function(){return this.done||this._changeState(Ee),this})),t(Ae.prototype,"done",(function(){return this._state===Ee||this._state===be}));export{Ae as default};
//# sourceMappingURL=index.mjs.map
