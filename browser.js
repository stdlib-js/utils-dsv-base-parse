// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
var e,t;e=this,t=function(){"use strict";var e,t="function"==typeof Object.defineProperty?Object.defineProperty:null,i=Object.defineProperty,n=Object.prototype,s=n.toString,_=n.__defineGetter__,o=n.__defineSetter__,r=n.__lookupGetter__,a=n.__lookupSetter__;e=function(){try{return t({},"x",{}),!0}catch(e){return!1}}()?i:function(e,t,i){var c,h,u,d;if("object"!=typeof e||null===e||"[object Array]"===s.call(e))throw new TypeError("invalid argument. First argument must be an object. Value: `"+e+"`.");if("object"!=typeof i||null===i||"[object Array]"===s.call(i))throw new TypeError("invalid argument. Property descriptor must be an object. Value: `"+i+"`.");if((h="value"in i)&&(r.call(e,t)||a.call(e,t)?(c=e.__proto__,e.__proto__=n,delete e[t],e[t]=i.value,e.__proto__=c):e[t]=i.value),u="get"in i,d="set"in i,h&&(u||d))throw new Error("invalid argument. Cannot specify one or more accessors and a value or writable attribute in the property descriptor.");return u&&_&&_.call(e,t,i.get),d&&o&&o.call(e,t,i.set),e};var c=e;function h(e,t,i){c(e,t,{configurable:!1,enumerable:!1,writable:!1,value:i})}var u=Boolean;function d(){var e,t=arguments,i=t[0],n="https://stdlib.io/e/"+i+"?";for(e=1;e<t.length;e++)n+="&arg[]="+encodeURIComponent(t[e]);return n}function p(){}function l(e){throw e}function f(){return{comment:"",delimiter:",",doublequote:!0,escape:"",ltrim:!1,maxRows:1e308,newline:"\r\n",onClose:p,onColumn:p,onComment:null,onError:l,onRow:p,onSkip:null,onWarn:null,quote:'"',quoting:!0,rowBuffer:[],rtrim:!1,skip:"",skipBlankRows:!1,skipRow:null,strict:!0,trimComment:!0,whitespace:[" "]}}var m=["closed","comment","escape","error","field","init","quote_end","quoted_escape","quoted_field","skip","skipped_comment","skipped_escape","skipped_field","skipped_quote_end","skipped_quoted_escape","skipped_quoted_field"],w=function(){var e,t;for(e={},t=0;t<m.length;t++)e[m[t]]=t;return e}(),g=w.closed,k=w.init,x=w.error;function q(e,t){return e<t?t:e}var v=w.error,L=w.field,S=w.escape,I=w.field,b=w.init,y=w.quoted_field,E=w.comment,C=w.field,R=w.escape,B=w.init,W=w.quoted_field,A=w.skip,F=w.error,j=w.field,P=w.init,V=w.quoted_field,D=w.error,O=w.quoted_field,T=w.quote_end,N=w.quoted_escape,Q=w.init,G=w.skip,U=w.skipped_comment,z=w.skipped_field,H=w.skipped_escape,J=w.skipped_quoted_field,K=w.init,M=w.skipped_field,X=w.init,Y=w.skipped_escape,Z=w.skipped_field,$=w.skipped_quoted_field,ee=w.init,te=w.skipped_field,ie=w.skipped_quoted_field,ne=w.skipped_quoted_field,se=w.skipped_quote_end,_e=w.skipped_quoted_escape,oe={closed:function(e){return function(){e._changeState(g)}},comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){n===i[t]&&e._scan(i,t)?e._rewind(t)._changeState(k):e._push(n)}},escape:function(e){var t,i,n,s,_,o,r,a,c,h,u,d,p;return t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,a=e._newline,n=e._commentLastIndex,c=e._comment,_=e._skipLastIndex,d=e._skip,s=e._escapeLastIndex,o=e._escapeLength,h=e._escape,u=e._strict,p=q(q(t,i),s),function(l){var f=e._cursor,m=e._eidx,w=f-m;if(w===t&&l===r[t]&&e._scan(r,t))e._copyWithin(m-s,m+1,t)._rewind(o)._push(l)._changeState(L);else if(w===i&&l===a[i]&&e._scan(a,i))e._copyWithin(m-s,m+1,i)._rewind(o)._push(l)._changeState(L);else if(w===s&&l===h[s]&&e._scan(h,s))e._copyWithin(m-s,m+1,s)._rewind(o)._push(l)._changeState(L);else if(c&&f-n==0&&l===c[n]&&e._scan(c,n))e._copyWithin(m-n,m+1,n)._rewind(o)._push(l)._changeState(L);else{if(!d||f-_!=0||l!==d[_]||!e._scan(d,_))return w>=p?u?void e._setErrorState("INVALID_ESCAPE")._changeState(v):void e._raiseWarning("INVALID_ESCAPE")._push(l)._changeState(L):void e._push(l);e._copyWithin(m-_,m+1,_)._rewind(o)._push(l)._changeState(L)}}},error:function(e){return function(){e._changeState(x)}},field:function(e){var t,i,n,s,_,o,r,a,c;return n=e._escapeLastIndex,a=e._escape,s=e._quoteLastIndex,c=e._quote,t=e._delimiterLastIndex,_=e._delimiter,i=e._newlineLastIndex,o=e._newline,r=e._quoting,function(h){var u=e._cursor-e._cidx+1;if(h!==a[n]||!e._scan(a,n))return u-s==0&&h===c[s]&&e._scan(c,s)?r?void e._rewind(s)._changeState(y):void e._push(h):void(h===_[t]&&e._scan(_,t)?e._rewind(t)._changeState(I):h===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(b):e._push(h));e._push(h)._changeState(S)}},init:function(e){var t,i,n,s,_,o,r,a,c,h,u,d,p;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,p=e._skip,s=e._escapeLastIndex,u=e._escape,_=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,a=e._newline,h=e._quoting,function(l){var f=e._cursor+1;if(c&&f-n==0&&l===c[n]&&e._scan(c,n))e._rewind(n)._changeState(E);else if(p&&f-o==0&&l===p[o]&&e._scan(p,o))e._rewind(o)._changeState(A);else{if(l!==u[s]||!e._scan(u,s))return f-_==0&&l===d[_]&&e._scan(d,_)?h?void e._rewind(_)._changeState(W):void e._push(l):void(l===r[t]&&e._scan(r,t)?e._rewind(t)._changeState(C):l===a[i]&&e._scan(a,i)?e._rewind(i)._changeState(B):e._push(l));e._push(l)._changeState(R)}}},quote_end:function(e){var t,i,n,s,_,o,r,a;return t=e._delimiterLastIndex,_=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,r=e._quote,s=e._doublequote,a=q(q(t,i),n),function(c){s&&c===r[n]&&e._scan(r,n)?e._push(c)._changeState(V):c===_[t]&&e._scan(_,t)?e._rewind(t)._changeState(j):c===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(P):e._cursor-e._qidx>=a?e._setErrorState("INVALID_CLOSING_QUOTE")._changeState(F):e._push(c)}},quoted_escape:function(e){var t,i,n,s,_;return i=e._quoteLastIndex,_=e._quote,t=e._escapeLastIndex,n=e._escapeLength,s=e._strict,function(o){var r=e._cursor,a=e._eidx,c=r-a;if(c!==i||o!==_[i]||!e._scan(_,i))return c>=i?s?void e._setErrorState("INVALID_QUOTED_ESCAPE")._changeState(D):void e._raiseWarning("INVALID_QUOTED_ESCAPE")._push(o)._changeState(O):void e._push(o);e._copyWithin(a-t,a+1,i)._rewind(n)._push(o)._changeState(O)}},quoted_field:function(e){var t,i,n,s,_;return t=e._escapeLastIndex,s=e._escape,i=e._quoteLastIndex,_=e._quote,n=e._doublequote,function(o){!1===n&&o===s[t]&&e._scan(s,t)?e._push(o)._changeState(N):o===_[i]&&e._scan(_,i)?e._rewind(i)._changeState(T):e._push(o)}},skip:function(e){var t,i,n,s,_,o,r,a,c,h,u,d,p;return n=e._commentLastIndex,c=e._comment,o=e._skipLastIndex,p=e._skip,s=e._escapeLastIndex,u=e._escape,_=e._quoteLastIndex,d=e._quote,t=e._delimiterLastIndex,r=e._delimiter,i=e._newlineLastIndex,a=e._newline,h=e._quoting,function(l){var f=e._cursor+1;if(c&&f-n==0&&l===c[n]&&e._scan(c,n))e._push(l)._changeState(U);else if(p&&f-o==0&&l===p[o]&&e._scan(p,o))e._push(l)._changeState(G);else{if(l!==u[s]||!e._scan(u,s))return f-_==0&&l===d[_]&&e._scan(d,_)?h?void e._push(l)._changeState(J):void e._push(l):void(l===r[t]&&e._scan(r,t)?e._push(l)._changeState(z):l===a[i]&&e._scan(a,i)?e._rewind(i)._changeState(Q):e._push(l));e._push(l)._changeState(H)}}},skipped_comment:function(e){var t,i;return t=e._newlineLastIndex,i=e._newline,function(n){n===i[t]&&e._scan(i,t)?e._rewind(t)._changeState(K):e._push(n)}},skipped_escape:function(e){var t,i,n,s,_,o,r,a,c,h,u;return t=e._delimiterLastIndex,o=e._delimiter,i=e._newlineLastIndex,r=e._newline,n=e._commentLastIndex,a=e._comment,_=e._skipLastIndex,h=e._skip,s=e._escapeLastIndex,c=e._escape,u=q(q(t,i),s),function(d){var p=e._cursor,l=e._eidx,f=p-l;f===t&&d===o[t]&&e._scan(o,t)||f===i&&d===r[i]&&e._scan(r,i)||f===s&&d===c[s]&&e._scan(c,s)||a&&p-n==0&&d===a[n]&&e._scan(a,n)||h&&p-_==0&&d===h[_]&&e._scan(h,_)||f>=u?e._push(d)._changeState(M):e._push(d)}},skipped_field:function(e){var t,i,n,s,_,o,r,a,c;return n=e._escapeLastIndex,a=e._escape,s=e._quoteLastIndex,c=e._quote,t=e._delimiterLastIndex,_=e._delimiter,i=e._newlineLastIndex,o=e._newline,r=e._quoting,function(h){var u=e._cursor-e._cidx+1;if(h!==a[n]||!e._scan(a,n))return u-s==0&&h===c[s]&&e._scan(c,s)?(e._push(h),r?void e._changeState($):void 0):void(h===_[t]&&e._scan(_,t)?e._push(h)._changeState(Z):h===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(X):e._push(h));e._push(h)._changeState(Y)}},skipped_quote_end:function(e){var t,i,n,s,_,o,r,a;return t=e._delimiterLastIndex,_=e._delimiter,i=e._newlineLastIndex,o=e._newline,n=e._quoteLastIndex,r=e._quote,s=e._doublequote,a=q(q(t,i),n),function(c){s&&c===r[n]&&e._scan(r,n)?e._push(c)._changeState(ie):c===_[t]&&e._scan(_,t)?e._push(c)._changeState(te):c===o[i]&&e._scan(o,i)?e._rewind(i)._changeState(ee):e._cursor-e._qidx>=a?e._push(c)._changeState(ie):e._push(c)}},skipped_quoted_escape:function(e){var t,i;return t=e._quoteLastIndex,i=e._quote,function(n){var s=e._cursor,_=e._eidx,o=s-_;o===t&&n===i[t]&&e._scan(i,t)||o>=t?e._push(n)._changeState(ne):e._push(n)}},skipped_quoted_field:function(e){var t,i,n,s,_;return t=e._escapeLastIndex,s=e._escape,i=e._quoteLastIndex,_=e._quote,n=e._doublequote,function(o){!1===n&&o===s[t]&&e._scan(s,t)?e._push(o)._changeState(_e):o===_[i]&&e._scan(_,i)?e._push(o)._changeState(se):e._push(o)}}};function re(e){var t,i;for(t=[],i=0;i<m.length;i++)t.push(oe[m[i]](e));return t}var ae,ce=()=>{},he=w.closed,ue=w.comment,de=w.error,pe=w.escape,le=w.field,fe=w.init,me=w.quote_end,we=w.quoted_escape,ge=w.quoted_field,ke=w.skip;function xe(e){var t;return this instanceof xe?(e=e||{},t=f(),this._buffer=[],this._cursor=-1,this._cidx=0,this._qidx=-1,this._eidx=-1,this._rowBufferFLG=u(e.rowBuffer),this._rowBuffer=e.rowBuffer||t.rowBuffer,this._col=0,this._row=0,this._line=0,this._commented=!1,this._skipped=!1,this._errname="",this._comment=e.comment||t.comment,this._delimiter=e.delimiter||t.delimiter,this._doublequote=void 0===e.doublequote?t.doublequote:e.doublequote,this._escape=e.escape||t.escape,this._ltrim=void 0===e.ltrim?t.ltrim:e.ltrim,this._maxRows=void 0===e.maxRows?t.maxRows:e.maxRows,this._newline=e.newline||t.newline,this._quote=e.quote||t.quote,this._quoting=void 0===e.quoting?t.quoting:e.quoting,this._rtrim=void 0===e.rtrim?t.rtrim:e.rtrim,this._skip=e.skip||t.skip,this._skipBlankRows=void 0===e.skipBlankRows?t.skipBlankRows:e.skipBlankRows,this._skipRow=e.skipRow||t.skipRow,this._strict=void 0===e.strict?t.strict:e.strict,this._trimComment=void 0===e.trimComment?t.trimComment:e.trimComment,this._whitespace=e.whitespace||t.whitespace,this._onClose=e.onClose||t.onClose,this._onColumn=e.onColumn||t.onColumn,this._onComment=e.onComment||t.onComment,this._onRow=e.onRow||t.onRow,this._onSkip=e.onSkip||t.onSkip,this._onError=e.onError||t.onError,this._onWarn=e.onWarn||t.onWarn,this._commentLength=this._comment.length,this._commentLastIndex=this._commentLength-1,this._delimiterLength=this._delimiter.length,this._delimiterLastIndex=this._delimiterLength-1,this._escapeLength=this._escape.length,this._escapeLastIndex=this._escapeLength-1,this._newlineLength=this._newline.length,this._newlineLastIndex=this._newlineLength-1,this._quoteLength=this._quote.length,this._quoteLastIndex=this._quoteLength-1,this._skipLength=this._skip.length,this._skipLastIndex=this._skipLength-1,this._skipRow&&this._skipRow(0,0)?(this._state=ke,this._skipped=!0):this._state=fe,this._states=re(this),this):arguments.length?new xe(e):new xe}return w.skipped_comment,w.skipped_escape,w.skipped_field,w.skipped_quote_end,w.skipped_quoted_escape,w.skipped_quoted_field,h(xe.prototype,"_push",(function(e){var t=this._buffer;return this._cursor+=1,this._cursor>=t.length?(t.push(e),ce("Internal buffer size increased. Length: %d.",t.length)):t[this._cursor]=e,ce("Cursor: %d. Push: %s",this._cursor,e),this})),h(xe.prototype,"_rewind",(function(e){return this._cursor-=e,ce("Rewind: %d. Cursor: %d.",e,this._cursor),this})),h(xe.prototype,"_copyWithin",(function(e,t,i){var n,s;for(n=this._buffer,s=0;s<i;s++)n[e+s]=n[t+s];return this})),h(xe.prototype,"_reset",(function(){return this._col=0,this._cidx=0,this._qidx=-1,this._eidx=-1,this._skipRow&&this._skipRow(this._row,this._line)?(this._state=ke,this._skipped=!0):(this._state=fe,this._skipped=!1),this._commented=!1,this._cursor=-1,this})),h(xe.prototype,"_setField",(function(e,t){var i=this._rowBuffer;return t>=i.length?(i.push(e),ce("Row buffer size increased. Length: %d.",i.length)):i[t]=e,this})),h(xe.prototype,"_getField",(function(e,t){var i,n,s;if(i=this._buffer,s=e,this._trim)for(n=this._whitespace;s<=t&&!1!==n.test(i[s]);s++);return i.slice(s,t+1).join("")})),h(xe.prototype,"_getRow",(function(){return this._rowBufferFLG?this._rowBuffer:this._rowBuffer.slice(0,this._col)})),h(xe.prototype,"_scan",(function(e,t){var i,n,s;for(i=this._buffer,n=this._cursor-t+1,s=0;s<t&&i[n+s]===e[s];s++);return s===t})),h(xe.prototype,"_onField",(function(){var e=this._getField(this._cidx,this._cursor);return this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),ce("Field. Line: %d. Row: %d. Column: %d. Value: %s",this._line,this._row,this._col,e),this._col+=1,this._cidx=this._cursor+1,this._qidx=-1,this._eidx=-1,this})),h(xe.prototype,"_onRecord",(function(){var e;return e=this._getField(this._cidx,this._cursor),this._skipBlankRows,this._setField(e,this._col),this._onColumn(e,this._row,this._col,this._line),this._col+=1,this._onRow(this._getRow(),this._row,this._col,this._line),ce("Record. Line: %d. Fields: %d.",this._line,this._col),this._row+=1,this._line+=1,this._reset(),this._row>=this._maxRows&&this._changeState(he),this})),h(xe.prototype,"_onCommentedRow",(function(){var e;return this._onComment?(e=this._buffer.slice(0,this._cursor+1).join(""),this._trimComment,this._onComment(e,this._line),ce("Comment. Line: %d. Value: %s",this._line,e)):ce("Comment. Line: %d.",this._line),this._line+=1,this._reset(),this})),h(xe.prototype,"_onSkippedRow",(function(){var e;return this._onSkip?(e=this._buffer.slice(0,this._cursor+1).join(""),this._onSkip(e,this._line),ce("Skipped row. Line: %d. Value: %s",this._line,e)):ce("Skipped row. Line: %d.",this._line),this._line+=1,this._reset(),this})),h(xe.prototype,"_onClosingQuote",(function(){return this._qidx=this._cursor,this})),h(xe.prototype,"_onEscape",(function(){return this._eidx=this._cursor,this})),h(xe.prototype,"_createException",(function(e){var t;switch(e){case"INVALID_CLOSING_QUOTE":t=new Error(d("unexpected error. Encountered an invalid record. Field %d on line %d contains a closing quote which is not immediately followed by a delimiter or newline.",this._col,this._line));break;case"INVALID_ESCAPE":t=new Error(d("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence which is not immediately followed by a special character sequence.",this._col,this._line));break;case"INVALID_QUOTED_ESCAPE":t=new Error(d("unexpected error. Encountered an invalid record. Field %d on line %d contains an escape sequence within a quoted field which is not immediately followed by a quote sequence.",this._col,this._line));break;case"CLOSED":t=new Error("invalid operation. Parser is unable to parse new chunks, as the parser has been closed. To parse new chunks, create a new parser instance.");break;default:t=new Error("invalid operation. Parser is in an unrecoverable error state. To parse new chunks, create a new parser instance.")}return t})),h(xe.prototype,"_raiseWarning",(function(e){var t;return this._onWarn&&(t=this._createException(e),ce("Warning: %s",t.message),this._onWarn(t)),this})),h(xe.prototype,"_raiseException",(function(){var e=this._createException(this._errname);return ce("Error: %s",e.message),this._onError(e),this})),h(xe.prototype,"_changeState",(function(e){switch(ce("State transition: %s -> %s.",m[this._state],m[e]),e){case he:this._close();break;case ue:this._commented=!0;break;case de:this._raiseException();break;case pe:this._onEscape();break;case le:this._state!==pe&&this._onField();break;case fe:this._commented?this._onCommentedRow():this._skipped?this._onSkippedRow():this._onRecord();break;case me:this._onClosingQuote();break;case we:this._onEscape();break;case ge:break;case ke:this._skipped=!0}return this._state=e,this})),h(xe.prototype,"_setErrorState",(function(e){return this._errname=e,this})),h(xe.prototype,"_close",(function(){var e,t;return this.done?(this._setErrorState(he)._changeState(de),this):(this._cursor>=0?(e=this._state)===fe||e===le||e===me?this._changeState(fe)._onClose():(this._col&&this._onRow(this._getRow(),this._row,this._col),t=this._buffer.slice(this._cidx,this._cursor+1).join(""),this._onClose(t)):this._onClose(),this)})),h(xe.prototype,"next",(function(e){var t,i;if(this.done)return this._setErrorState(he)._changeState(de),this;for(t=this._states,i=0;i<e.length;i++)if(t[this._state](e[i]),this._state===he||this._state===de)return this;return this})),h(xe.prototype,"close",(function(){return this.done||this._changeState(he),this})),ae=xe.prototype,c(ae,"done",{configurable:!1,enumerable:!1,get:function(){return this._state===he||this._state===de}}),xe},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Parser=t();
//# sourceMappingURL=browser.js.map
